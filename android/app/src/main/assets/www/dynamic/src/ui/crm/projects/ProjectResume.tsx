function module(e,t,n){var a,i,r,l,o,c,m,s,u,d,f,b,p,E,T,g,v,h,R,k,P,y,j,N,x,M,B;n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){a=e}},0),n.link("react",{default:function(e){i=e},useEffect:function(e){r=e},useState:function(e){l=e}},0),n.link("react-intl",{FormattedMessage:function(e){o=e},useIntl:function(e){c=e}},1),n.link("react-apexcharts",{default:function(e){m=e}},2),n.link("lodash/groupBy",{default:function(e){s=e}},3),n.link("moment",{default:function(e){u=e}},4),n.link("meteor/meteor",{Meteor:function(e){d=e}},5),n.link("@material-ui/core/Card",{default:function(e){f=e}},6),n.link("@material-ui/core/Grid",{default:function(e){b=e}},7),n.link("@material-ui/core/styles/makeStyles",{default:function(e){p=e}},8),n.link("@material-ui/core/Tooltip/Tooltip",{default:function(e){E=e}},9),n.link("../tasks/withTasks",{default:function(e){T=e}},10),n.link("../../../lib/time",{secondsToHms:function(e){g=e}},11),n.link("../../../lib/formatNumber",{default:function(e){v=e}},12),n.link("../../../lib",{getDurationDays:function(e){h=e}},13),n.link("../../components/Progress",{default:function(e){R=e}},14),n.link("../../../db/crm/labels",{default:function(e){k=e}},15),n.link("../../../db/crm/projects",{default:function(e){P=e}},16),n.link("../../../db/crm/taskstatus",{default:function(e){y=e}},17),n.link("../../components/MainLoader",{default:function(e){j=e}},18),n.link("../../../lib/users/getUsername",{default:function(e){N=e}},19),n.link("../../components/NoDataChart",{default:function(e){x=e}},20),n.link("../../../lib/users/haveRights",{default:function(e){M=e}},21),n.link("../../../constants/ROLES",{ROLES:function(e){B=e}},22);var S=p({box:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:16},container:{border:"1px solid lightgray",padding:8,margin:16},containerProgress:{margin:16},containerProgressTitle:{fontWeight:"bold",fontSize:"14"},boxTitle:{color:"grey"},boxValue:{fontWeight:"bold"},boxDanger:{fontSize:12,color:"red"},boxGood:{fontSize:12,color:"green"},hr:{margin:16,backgroundColor:"lightgray",height:1}}),D=function(e){var t=e.match.params.projectId,n=e.tasks,p=l(null),T=a(p,2),D=T[0],w=T[1],C,I=c().formatMessage,O=S();r((function(){d.promise("teams.projects.statsByProject",{projectId:t,startDate:u.utc("1970-01-01").toDate(),endDate:new Date}).then((function(e){return w(e[0])})).catch(console.error)}),[]);var W=P.findOne(t);if(!D)return i.createElement(j,null);var J=D.timeRemainingPlanned.withTask,z=D.timeRemainingPlanned.withoutTask,L=D.estimatedTime-D.reportedTimeTotal,A=Math.round(100*D.reportedTimeTotal/D.estimatedTime),G=Math.round(100*(D.reportedTimeTotal+J+z)/D.estimatedTime-100),_=y.find({isTerminateStatus:!0}).fetch().map((function(e){return e._id})),q=n.filter((function(e){return _.includes(e.taskstatusId)})).reduce((function(e,t){return e+Number(t.estimatedTime||0)}),0),F=n.filter((function(e){return _.includes(e.taskstatusId)})).reduce((function(e,t){var n;return e+(t.reportedTime>t.estimatedTime?Number(t.estimatedTime||0):Number(t.reportedTime||0))}),0),U=Math.round(100*(q+F)/D.taskEstimatedTime),V=function(e){var t=e.label,n=e.value,a=e.type,r=void 0===a?"hours":a,l=e.danger,o=void 0===l?null:l,c=e.good,m=void 0===c?null:c,s=e.sub,u=void 0!==s&&s;return i.createElement("div",{className:O.box,style:{fontSize:u?13:16}},i.createElement("div",{className:O.boxTitle},t,o&&i.createElement("div",{className:O.boxDanger},o),m&&i.createElement("div",{className:O.boxGood},m)),i.createElement("div",{className:O.boxValue},"hours"===r&&i.createElement(E,{title:h(n)+" "+I({id:"days"})},i.createElement("div",{className:"have-tooltip"},g(n))),"currency"===r&&v(n)))},H={chart:{id:"basic-pie"},tooltip:{y:{formatter:function(e){return g(e)}}},labels:[I({id:"ProjectResume.ReportedNotBillable"}),I({id:"ProjectResume.ReportedBillable"}),I({id:"ProjectResume.Remaining"})],legend:{position:"bottom"}},K=s(n.map((function(e){return e.detailReport})).flat(),(function(e){return e.labelId})),Q=Object.keys(K).map((function(e){return{name:k.findOne(e).name,time:K[e].reduce((function(e,t){return e+t.hours}),0)}})),X={chart:{id:"basic-pie"},tooltip:{y:{formatter:function(e){return g(e)}}},legend:{position:"bottom"},labels:Q.map((function(e){return e.name}))},Y=s(n.map((function(e){return e.detailReport})).flat(),(function(e){return e.userId})),Z=Object.keys(Y).map((function(e){return{name:N(e),time:Y[e].reduce((function(e,t){return e+t.hours}),0)}})),$={chart:{id:"basic-pie"},tooltip:{y:{formatter:function(e){return g(e)}}},legend:{position:"bottom"},labels:Z.map((function(e){return e.name}))};return M(B.ACCESS_RESUME_PROJECT)?i.createElement("div",null,"regie"!==W.billing&&D.estimatedTime>0&&i.createElement("div",{className:O.containerProgress},i.createElement("div",{className:O.containerProgressTitle},i.createElement(o,{id:"ProjectResume.TimeProgressEstimated"})),i.createElement(R,{value:A})),n.length>1&&i.createElement("div",{className:O.containerProgress},i.createElement("div",{className:O.containerProgressTitle},i.createElement(o,{id:"ProjectResume.TaskProgress"})),i.createElement(R,{value:U})),i.createElement(b,{container:!0,spacing:2},i.createElement(b,{item:!0,xs:12,sm:5},i.createElement(f,null,i.createElement("div",{className:O.container},i.createElement(V,{label:I({id:"ProjectResume.Amount"}),type:"currency",value:D.amountTotal}),i.createElement("div",{className:O.hr}),i.createElement(V,{label:I({id:"ProjectResume.TJMTheorique"}),type:"currency",value:D.TJMTheorique}),i.createElement(V,{label:I({id:"ProjectResume.TJMEstimate"}),type:"currency",value:D.TJMReel})),i.createElement("div",{className:O.container},i.createElement(V,{label:I({id:"ProjectResume.Estimate"}),value:D.estimatedTime}),i.createElement(V,{label:I({id:"ProjectResume.Remaining"}),value:L>0?L:0})),i.createElement("div",{className:O.container},i.createElement(V,{label:I({id:"ProjectResume.Reported"}),value:D.reportedTimeTotal}),i.createElement("div",{className:O.hr}),i.createElement(V,{sub:!0,label:I({id:"ProjectResume.Billable"}),value:D.reportedTimeBillableTotal}),i.createElement(V,{sub:!0,label:I({id:"ProjectResume.NotBillable"}),value:D.reportedTimeTotal-D.reportedTimeBillableTotal})),i.createElement("div",{className:O.container},i.createElement(V,{label:I({id:"ProjectResume.PlannedRemaining"}),value:J+z}),i.createElement("div",{className:O.hr}),i.createElement(V,{sub:!0,label:I({id:"ProjectResume.WithTasks"}),value:J}),i.createElement(V,{sub:!0,label:I({id:"ProjectResume.WithoutTasks"}),value:z})),i.createElement("div",{className:O.container},i.createElement(V,{label:I({id:"ProjectResume.TotalTimeEstimate"}),danger:G>0&&I({id:"ProjectResume.exceededTime"},{value:G}),good:G<0&&I({id:"ProjectResume.avanceTime"},{value:Math.abs(G)}),value:D.reportedTimeTotal+J+z})))),i.createElement(b,{item:!0,xs:12,sm:7},i.createElement(b,{container:!0,spacing:2},i.createElement(b,{item:!0,xs:12,sm:6},i.createElement(f,null,i.createElement("div",{style:{fontWeight:"bold",margin:8}},I({id:"ProjectResume.RepartitionTempsFacturable"})),D.reportedTimeTotal-D.reportedTimeBillableTotal>0||D.reportedTimeBillableTotal>0||L>0?i.createElement(m,{options:H,type:"pie",series:[D.reportedTimeTotal-D.reportedTimeBillableTotal,D.reportedTimeBillableTotal,L],width:"100%"}):i.createElement(x,null))),i.createElement(b,{item:!0,xs:12,sm:6},i.createElement(f,null,i.createElement("div",{style:{fontWeight:"bold",margin:8}},I({id:"ProjectResume.RepartitionLabel"})),Q.find((function(e){return e.time>0}))?i.createElement(m,{options:X,type:"pie",series:Q.map((function(e){return e.time})),width:"100%"}):i.createElement(x,null))),i.createElement(b,{item:!0,xs:12,sm:6},i.createElement(f,null,i.createElement("div",{style:{fontWeight:"bold",margin:8}},I({id:"ProjectResume.RepartitionCollab"})),Z.find((function(e){return e.time>0}))?i.createElement(m,{options:$,type:"pie",series:Z.map((function(e){return e.time})),width:"100%"}):i.createElement(x,null))))))):null};n.exportDefault(T(D))}

