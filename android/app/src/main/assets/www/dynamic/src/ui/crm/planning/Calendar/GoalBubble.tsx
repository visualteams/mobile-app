function module(t,e,n){var a,i,o,l,r,d,s,u,c,f,m,g,p,h,v,y,b,D,k,E,S,x,I,R,M,Y,j,z,C;n.link("@babel/runtime/helpers/objectSpread2",{default:function(t){a=t}},0),n.link("@babel/runtime/helpers/slicedToArray",{default:function(t){i=t}},1),n.link("react",{default:function(t){o=t},useEffect:function(t){l=t},useState:function(t){r=t}},0),n.link("moment",{default:function(t){d=t}},1),n.link("date-fns",{addDays:function(t){s=t},differenceInSeconds:function(t){u=t},isSameDay:function(t){c=t}},2),n.link("re-resizable",{Resizable:function(t){f=t}},3),n.link("clsx",{default:function(t){m=t}},4),n.link("meteor/meteor",{Meteor:function(t){g=t}},5),n.link("react-intl",{FormattedMessage:function(t){p=t}},6),n.link("@material-ui/icons/TimerOff",{default:function(t){h=t}},7),n.link("@material-ui/core/styles/makeStyles",{default:function(t){v=t}},8),n.link("@material-ui/icons/Assignment",{default:function(t){y=t}},9),n.link("@material-ui/icons/HourglassFull",{default:function(t){b=t}},10),n.link("@material-ui/icons/Duo",{default:function(t){D=t}},11),n.link("./Calendar",{heightCellDay:function(t){k=t},widthCellDay:function(t){E=t}},12),n.link("../../../../lib",{getDurationHours:function(t){S=t}},13),n.link("../../../../db/crm/projects/index",{default:function(t){x=t}},14),n.link("../../../../db/crm/projectstatus",{default:function(t){I=t}},15),n.link("./TooltipPlanning",{default:function(t){R=t}},16),n.link("../../../components/HTMLTooltip",{default:function(t){M=t}},17),n.link("../../../../lib/whiteOrBlack",{default:function(t){Y=t}},18),n.link("../../../../db/crm/tasks",{default:function(t){j=t}},19),n.link("@visualteams/ui-kit/colors",{default:function(t){z=t}},20),n.link("./PlaceHolder",{DragInProgress:function(t){C=t}},21);var H={color:"#e5e5e5"},T=v({fakeZone:function(){return{position:"absolute",top:0,bottom:0,width:E}},timeReport:{position:"absolute",bottom:0,fontSize:11,padding:"0 2px",borderTopLeftRadius:4,minWidth:32,maxWidth:32,minHeight:18,maxHeight:18,display:"flex",alignItems:"center",justifyContent:"center"},projectName:{fontSize:12,lineHeight:"17px",whiteSpace:"nowrap",overflow:"hidden",margin:4},timeEstimated:{position:"absolute",bottom:0,left:0,fontSize:11,minHeight:18,maxHeight:18,padding:"0 2px",borderTopRightRadius:4,borderBottomLeftRadius:4,fontStyle:"italic"},projectBulle:{minHeight:k,maxHeight:k,width:"100%",borderRadius:4,position:"absolute",cursor:"pointer",height:"100%",zIndex:2,border:"2px solid transparent","&:hover":{border:"2px solid "+z.grey}},root:{"&:hover .right-handler":{opacity:"1"}},rightHandler:{backgroundColor:z.grey,width:"12px !important",borderTopRightRadius:4,borderBottomRightRadius:4,zIndex:2,right:"0px !important",fontWeight:600,color:"#ffffff",fontSize:10,opacity:0,"&:hover":{opacity:1}}}),O=function(t){var e,n,v,z,O,w,B,N,L,P=t.goal,A=void 0===P?{}:P,F=t.projectId,_=t.nbDay,G=t.day,W=t.startDate,Z=t.reports,V=void 0===Z?[]:Z,$=t.holidays,J=void 0===$?[]:$,q=t.order,K=t.onClick,Q=r(!1),U=i(Q,2),X=U[0],tt=U[1],et=r(!1),nt=i(et,2),at=nt[0],it=nt[1],ot=x.findOne({_id:F})||H,lt=I.find({$or:[{isValidated:{$exists:!1}},{isValidated:!1}]}).fetch().map((function(t){return t._id})),rt=T();l((function(){gt()}),[]);var dt=function(){var t=A.startDate?A.startDate:J[0]?J[0].startDate:V[0].date,e=d.utc(d.utc(t).format("YYYY-MM-DD")<G.format("YYYY-MM-DD")?G.toISOString():t).format("YYYY-MM-DD");return d.utc(e).format("YYYY-MM-DD")>d.utc(W).format("YYYY-MM-DD")?d.utc(e).endOf("day").diff(d.utc(W).startOf("day"),"days"):0},st=function(){var t=1,e=_,n=A.startDate?A:J[0];if(n&&n.endDate>n.startDate){var a=d.utc(n.startDate).isBefore(G)?G.toISOString():n.startDate;t=d.utc(n.endDate).endOf("day").diff(d.utc(a).startOf("day"),"days")+1;var i=d.utc(W).add(_,"days");e=d.utc(i).endOf("day").diff(d.utc(a).startOf("day"),"days")}return t>e?e:t},ut=function(t){return function(e){X?(e.dataTransfer.setData("goal",JSON.stringify(t)),e.dataTransfer.setData("nbDays",st()),it(!0),C.set(!0)):e.preventDefault()}},ct=function(){return C.set(!1)},ft=function(){tt(!1)},mt=function(t,e,n,i){var o,l=Math.round(i.width/E),r=null,s=null,u;if("right"===e&&(r=A.startDate,s=d.utc(A.endDate).add(l,"day").toISOString()),null!==(o=A.taskIds)&&void 0!==o&&o[0])u=A.estimatedTime;else{var c=d.utc(A.endDate).diff(d.utc(A.startDate),"days")+1,f=d.utc(s).diff(d.utc(r),"days")+1;u=A.estimatedTime/c*f}var m=a(a({},A),{},{startDate:r,endDate:s,estimatedTime:u});g.promise("goals.update",m._id,m),gt()},gt=function(){"goal"===A.type?tt(!0):tt(!1)},pt=function(t){var e=0;return V.filter((function(e){var n,a;return(c(e.date,s(A.startDate,t))||!A.startDate)&&e.taskId===(null===(n=A.taskIds)||void 0===n?void 0:n[0])})).forEach((function(t){t.hours&&t.hours.forEach((function(t){e+=u(t.endDate,t.startDate)}))})),e},ht=st(),vt=dt(),yt=ht*E-3,bt=J&&J.length>0,Dt;"all"===(null==J||null===(e=J[0])||void 0===e?void 0:e.type)?Dt="#000000":"morning"===(null==J||null===(n=J[0])||void 0===n?void 0:n.type)?Dt="linear-gradient(335deg, rgba(255,255,255,1) 50%, rgba(0,0,0,1) 50%)":"afternoon"===(null==J||null===(v=J[0])||void 0===v?void 0:v.type)&&(Dt="linear-gradient(335deg, rgba(0,0,0,1) 50%, rgba(255,255,255,1) 50%)");for(var kt=bt?"#ff0000":null,Et=bt?Dt:ot.color,St=[],xt=0,It=function(t){var e=pt(t);xt+=e,St.push(o.createElement("div",{draggable:!1,key:A._id+"-"+t,className:rt.timeReport,onClick:function(e){e.preventDefault(),e.stopPropagation(),K(d.utc(G).add(t,"day"))},style:{left:E*(t+1),marginLeft:t+1===ht?-39:-35,borderBottomRightRadius:t+1===ht?4:0}},S(e)))},Rt=0;Rt<ht;Rt+=1)It(Rt);for(var Mt=[],Yt=function(t){Mt.push(o.createElement("div",{draggable:!1,key:A._id+"-"+t+"-fakeZone",onClick:function(e){e.preventDefault(),e.stopPropagation(),K(d.utc(G).add(t,"day"))},className:rt.fakeZone,style:{left:E*(t+1),marginLeft:-E}}))},jt=1;jt<ht;jt+=1)Yt(jt);var zt=14,Ct=function(t){return o.createElement("div",t,o.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:k}},o.createElement("div",null,"||")))};return o.createElement("div",{draggable:X,onDragStart:ut(A),onDragEnd:ct,className:rt.root},o.createElement(f,{size:{width:yt,height:k},grid:[E,E],onResizeStart:ft,onResizeStop:mt,style:{position:"absolute",transform:"translate("+vt*E+"px, "+q*(k+3)+"px) rotate("+(at?"-5":0)+"deg)",zIndex:at?101:2,visibility:at?"hidden":"visible",transition:"all 1s, visibility 0.01s"},handleClasses:{right:"right-handler "+rt.rightHandler},handleComponent:{right:o.createElement(Ct,null)},enable:{top:!1,right:"goal"===A.type,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}},o.createElement(M,{arrow:!0,open:!at&&void 0,title:F?o.createElement(R,{goal:A,projectId:F,customerId:ot.customerId,timeReported:xt}):o.createElement("div",null,"all"===(null==J||null===(z=J[0])||void 0===z?void 0:z.type)&&o.createElement(p,{id:"GoalBubble.HolidaysAll",defaultMessage:"Congés : Toute la journée"}),"morning"===(null==J||null===(O=J[0])||void 0===O?void 0:O.type)&&o.createElement(p,{id:"GoalBubble.HolidaysMorning",defaultMessage:"Congés : Matin"}),"afternoon"===(null==J||null===(w=J[0])||void 0===w?void 0:w.type)&&o.createElement(p,{id:"GoalBubble.HolidaysAfternoon",defaultMessage:"Congés : Après-midi"}))},o.createElement("div",{className:rt.projectBulle,onClick:function(){return K(G)},style:{overflow:"hidden",background:Et,opacity:lt&&lt.includes(ot.projectStatusId)?.5:1,color:null!=kt?kt:Y(Et),border:bt?"1px solid black":void 0,height:k}},o.createElement("div",{draggable:!1,className:m([rt.projectName,"project-name-planning"])},o.createElement("div",{style:{display:"flex",alignItems:"center"}},"event"===A.type&&o.createElement(o.Fragment,null,o.createElement(D,{style:{fontSize:zt,marginRight:2}}),ot.name),0===(null===(B=A.taskIds)||void 0===B?void 0:B.length)&&"event"!==A.type&&o.createElement(o.Fragment,null,o.createElement(b,{style:{fontSize:zt,marginRight:2}}),ot.name),(null===(N=A.taskIds)||void 0===N?void 0:N.length)>0&&o.createElement(o.Fragment,null,o.createElement(y,{style:{fontSize:zt,marginRight:2}}),null===(L=j.findOne(A.taskIds[0]))||void 0===L?void 0:L.description))),Mt,!bt&&St,A.estimatedTime>0&&o.createElement("div",{draggable:!1,className:rt.timeEstimated},S(A.estimatedTime/ht)," ",ht>1&&o.createElement(p,{id:"GoalBubble.PerDay",defaultMessage:"par jour"})),bt&&o.createElement("div",{draggable:!1,style:{display:"flex",alignItems:"center",justifyContent:"center",height:k}},o.createElement(h,{fontSize:"small"}))))))};n.exportDefault(o.memo(O,(function(){return!1})))}

