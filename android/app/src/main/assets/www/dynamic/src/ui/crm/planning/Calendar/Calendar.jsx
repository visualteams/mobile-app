function module(e,t,n){var r,a,i,l,o,c,s,u,d,f,m,g,y,h,v,k,p,E,b,w,D,B,I,S,C,N,_,x,L,U;n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),n.export({widthCellDay:function(){return A},heightCellDay:function(){return R},factorWeek:function(){return T},factorMonth:function(){return W},firstColumnWidth:function(){return M},view:function(){return O}}),n.link("react",{default:function(e){a=e},useRef:function(e){i=e},useEffect:function(e){l=e},useState:function(e){o=e}},0),n.link("moment",{default:function(e){c=e}},1),n.link("meteor/react-meteor-data",{withTracker:function(e){s=e}},2),n.link("clsx",{default:function(e){u=e}},3),n.link("react-intl",{FormattedMessage:function(e){d=e}},4),n.link("react-router-dom",{useHistory:function(e){f=e}},5),n.link("@material-ui/core/Button",{default:function(e){m=e}},6),n.link("@material-ui/icons/PersonAdd",{default:function(e){g=e}},7),n.link("../../../components/UserAvatar",{default:function(e){y=e}},8),n.link("./Popup",{default:function(e){h=e}},9),n.link("./Background",{default:function(e){v=e}},10),n.link("./HeaderDayDisplayer",{default:function(e){k=e}},11),n.link("../../../../db/teams/holidays",{default:function(e){p=e}},12),n.link("../../../../db/crm/goals",{default:function(e){E=e}},13),n.link("../../../../db/crm/reports/collection_client",{default:function(e){b=e}},14),n.link("./style",{useStyles:function(e){w=e}},15),n.link("./lib/getBubblesForPeriod",{default:function(e){D=e}},16),n.link("./lib/getBubblesForDay",{default:function(e){B=e}},17),n.link("./ToolbarFloating",{default:function(e){I=e}},18),n.link("../../../App",{startDateCalendar:function(e){S=e},endDateCalendar:function(e){C=e}},19),n.link("../../../../lib/getAllUsersInTeam",{default:function(e){N=e}},20),n.link("../../../../db/crm/projects/collection",{default:function(e){_=e}},21),n.link("../../../../lib/users/haveRights",{default:function(e){x=e}},22),n.link("../../../../constants/ROLES",{ROLES:function(e){L=e}},23),n.link("../../../../lib/hooks/useMobile",{default:function(e){U=e}},24);var A=104,R=48,T=2,W=3,M=130,O=ReactiveVar("day"),F={},H=0,P=function(e,t){return e.profile.firstname<t.profile.firstname?-1:0},j=function(e){return e._id===Meteor.userId()?-1:0},q=function(e){var t=e.users,s=e.startDate,p=e.nbDay,E=e.goals,b=e.reports,N=e.goalsByUser,_=e.reportsByUser,q=e.holidaysByUser,z=i(),G=o(!1),V=r(G,2),Y=V[0],J=V[1],K=f(),Q,X=U().isMobile,Z=w({});n.runSetters(M=X?42:130,["firstColumnWidth"]),l((function(){window.addEventListener("keyup",(function(e){F[e.key]=!1})),window.addEventListener("keydown",(function(e){F[e.key]=!0})),ne()}),[]),l((function(){var e=new IntersectionObserver((function(e){!0===e[0].isIntersecting?J(!1):J(!0)}),{threshold:[0]}),t=document.getElementById("today-cell");t&&e.observe(t)}),[O.get()]);var $=function(){var e=document.getElementById("planning-container");document.querySelectorAll("#background-planning > div").forEach((function(t){return t.style.height=e.scrollHeight+"px"})),document.querySelectorAll(".row-calendar-background").forEach((function(t){return t.style.width=e.scrollWidth+"px"}))};l((function(){z.current&&(0!==H&&(z.current.scrollLeft=H,H=0),$())}));var ee=function(e){z.current&&(z.current.scrollLeft=z.current.scrollLeft+e)},te=function(){K.push("/settings/users")},ne=function(){var e=document.getElementById("today-cell");if(e&&z.current){var t=e.offsetLeft,n=A,r=X?1:4;"week"===O.get()&&(n*=T,r=2),"month"===O.get()&&(n*=W,r=1),z.current.scrollLeft=t-n*r}},re=function(){if(document.getElementById("users-container").style.transform="translateY(-"+z.current.scrollTop+"px)",0===H){var e=28;"week"===O.get()&&(e*=T),"month"===O.get()&&(e*=W);var t=A;"week"===O.get()&&(t*=T),"month"===O.get()&&(t*=W);var n=document.getElementById("container-days");if(z.current.scrollLeft<=.1*(n.offsetWidth-z.current.clientWidth)){var r=c.utc(S.get()).subtract(e,"days").startOf(O.get()).toISOString();S.set(r);var a=e;"week"===O.get()&&(a/=7),"month"===O.get()&&(a/=30),H=a*t+.1*(n.offsetWidth-z.current.clientWidth)}else if(z.current.scrollLeft>=.9*(n.offsetWidth-z.current.clientWidth)){var i=c.utc(C.get()).add(e,"days").endOf(O.get()).toISOString();C.set(i)}}},ae=[],ie=[];t&&t.sort(P).sort(j).forEach((function(e){var t={data:[],maxItemsperRow:0};"day"===O.get()?t=B({goalsByUser:N,user:e,startDate:s,reportsByUser:_,holidaysByUser:q,goals:E,reports:b,nbDay:p}):"week"!==O.get()&&"month"!==O.get()||(t=D({goalsByUser:N,user:e,startDate:s})),ie.push(a.createElement(a.Fragment,{key:e._id},a.createElement("div",{className:"user-col",style:{height:t.maxItemsperRow*R+R,width:M}},a.createElement(y,{userId:e._id,disableDisplayName:X,disableCalculationAvailable:X})),a.createElement("div",{className:Z.lineSpacer}))),ae.push(a.createElement(a.Fragment,{key:e._id},a.createElement("div",{className:u(["row-calendar-background",Z.rowCalendarBackground]),style:{height:t.maxItemsperRow*R+R}}),"day"===O.get()&&a.createElement("div",{className:Z.rowCalendar,id:e._id,style:{height:t.maxItemsperRow*R+R}},t.data),("week"===O.get()||"month"===O.get())&&a.createElement("div",{className:Z.rowCalendar,id:e._id,style:{height:R}},t.data),a.createElement("div",{className:Z.lineSpacer})))}));var le=69,oe="calc(100vh - 69px)";return a.createElement(a.Fragment,null,a.createElement("div",{id:"planning-container",className:Z.root,style:{minHeight:oe,maxHeight:oe},ref:z,onScroll:re},a.createElement(h,null),a.createElement(k,{startDate:s,nbDay:p,onMouseMove:ee,view:O.get()}),a.createElement(v,{startDate:s,nbDay:p,view:O.get()}),a.createElement("div",{className:Z.lineSpacer}),a.createElement("div",{className:Z.rowsContainer},ae,a.createElement("div",{className:u(["row-calendar-background",Z.rowCalendarBackground]),style:{height:R+R}}))),a.createElement("div",{className:Z.userColContainer,style:{top:"calc(69px + 22px)",height:oe}},a.createElement("div",{id:"users-container",className:Z.usersContainer},ie,a.createElement("div",{className:"user-col",onClick:te},X&&a.createElement(g,{style:{marginLeft:8,marginTop:8}}),!X&&x(L.MANAGE_USERS)&&a.createElement(m,{variant:"outlined",style:{width:M/3*2,marginLeft:M/3/2,marginTop:2*R/4}},a.createElement(d,{id:"Calendar.Invite"}))))),a.createElement("div",{className:Z.toolbarFloating},a.createElement(I,{scrollToToday:ne}),Y&&a.createElement("div",null,a.createElement(m,{variant:"contained",size:"small",onClick:ne},a.createElement(d,{id:"today",defaultMessage:"Today"})))))};n.exportDefault(s((function(e){var t=e.match.params.projectId,n=c.utc(S.get()).toDate(),r=c.utc(C.get()).toDate(),a=c.utc(r).diff(n,O.get()),i=N({displayOnPlanning:!0});if(t){var l=_.findOne(t).usersId;i=i.filter((function(e){return l.includes(e._id)}))}var o=E.find().fetch(),s=b.find().fetch(),u=t?[]:p.find({}).fetch(),d=function(e){for(var t={},r={},i={},l=function(a){var l=c.utc(n).add(a,"days");t[a]=o.filter((function(t){return t.usersId.includes(e._id)&&l.isSame(t.startDate,"day")})),i[a]=u.filter((function(t){return t.userId===e._id&&l.isSame(t.startDate,"day")})),r[a]=s.filter((function(t){return t.createdBy===e._id&&l.isSame(t.date,"day")}))},d=0;d<a;d=d+=1)l(d);return{goals:t,reports:r,holidays:i}},f={},m={},g={};return i.forEach((function(e){var t=d(e);f[e._id]=t.goals,m[e._id]=t.reports,g[e._id]=t.holidays})),{users:i,goals:o,reports:s,goalsByUser:f,reportsByUser:m,holidaysByUser:g,startDate:n,nbDay:a}}))(q))}

