function module(e,t,n){var i,r,o,l,a,u,c,s,d,f,m,p,k,g,b,v,j,E,h,y,I,C,P,S,D,L,A,F,R,T,_,M,x,B,z,O,w,H,N,U,q,J,G,Y,K,Q;n.link("@babel/runtime/regenerator",{default:function(e){i=e}},0),n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){r=e}},1),n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){o=e}},2),n.link("react",{default:function(e){l=e},Fragment:function(e){a=e},useState:function(e){u=e}},0),n.link("meteor/react-meteor-data",{useTracker:function(e){c=e}},1),n.link("react-intl",{FormattedMessage:function(e){s=e},useIntl:function(e){d=e}},2),n.link("react-router-dom",{useHistory:function(e){f=e}},3),n.link("react-toastify",{toast:function(e){m=e}},4),n.link("meteor/meteor",{Meteor:function(e){p=e}},5),n.link("material-ui-confirm",{useConfirm:function(e){k=e}},6),n.link("@material-ui/icons/BookmarkBorder",{default:function(e){g=e}},7),n.link("@material-ui/icons/Bookmark",{default:function(e){b=e}},8),n.link("@material-ui/icons/FileCopy",{default:function(e){v=e}},9),n.link("@material-ui/core/styles/makeStyles",{default:function(e){j=e}},10),n.link("@material-ui/core/Tooltip",{default:function(e){E=e}},11),n.link("@material-ui/icons/FilterList",{default:function(e){h=e}},12),n.link("@material-ui/icons/Assessment",{default:function(e){y=e}},13),n.link("@material-ui/core/IconButton",{default:function(e){I=e}},14),n.link("@material-ui/icons/Print",{default:function(e){C=e}},15),n.link("@visualteams/ui-kit/colors",{default:function(e){P=e}},16),n.link("../../components/crm/MaterialTable",{default:function(e){S=e}},17),n.link("../../../lib",{findOne:function(e){D=e},getDurationHours:function(e){L=e}},18),n.link("../../../db/crm/projects",{default:function(e){A=e}},19),n.link("../../../db/crm/projectstatus",{default:function(e){F=e}},20),n.link("../../components/crm/ChipCustomer",{default:function(e){R=e}},21),n.link("../../components/crm/ChipProject",{default:function(e){T=e}},22),n.link("../../../lib/hooks/useListInvoices",{default:function(e){_=e}},23),n.link("../../../lib/formatNumber",{default:function(e){M=e}},24),n.link("../../../lib/users/haveRights",{default:function(e){x=e}},25),n.link("../../../constants/ROLES",{ROLES:function(e){B=e}},26),n.link("../../../db/projectsBookmarks",{default:function(e){z=e}},27),n.link("./AddProject",{default:function(e){O=e}},28),n.link("../../components/Button",{default:function(e){w=e}},29),n.link("../../../db/crm/customers",{default:function(e){H=e}},30),n.link("../../components/FilterColumns",{default:function(e){N=e}},31),n.link("../../../lib/table/alterColumns",{default:function(e){U=e}},32),n.link("../../../lib/users/haveSub",{default:function(e){q=e}},33),n.link("../../components/UserAvatar",{default:function(e){J=e}},34),n.link("../../../lib/users/getUsername",{default:function(e){G=e}},35),n.link("../../../lib/dates/displayDate",{default:function(e){Y=e},DateFormat:function(e){K=e}},36),n.link("@material-table/exporters",{ExportCsv:function(e){Q=e}},37);var V=j({iconBookmark:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:18,marginRight:16,"&:hover":{color:P.grey}},iconContainer:{display:"flex",alignItems:"center"}}),W=function(){var e,t=d().formatMessage,n=u(!1),j=o(n,2),P=j[0],W=j[1],X=u(!1),Z=o(X,2),$=Z[0],ee=Z[1],te=u(["amountHourly","invoicesId","startDate","endDate"]),ne=o(te,2),ie=ne[0],re=ne[1],oe=V(),le=c((function(){return A.find().fetch()}),[]),ae=c((function(){return H.find().fetch()}),[]),ue=c((function(){return F.find().fetch()}),[]),ce,se=c((function(){return z.find().fetch()}),[]).map((function(e){return e.projectId})),de=f(),fe,me=_().listInvoicesAll,pe=k(),ke=function(e){return function(n){return n.preventDefault(),n.stopPropagation(),p.promise("projects.bookmark",{projectId:e}).then((function(){return m.success(t({id:"success"}))})).catch((function(){return m.error(t({id:"error"}))}))}},ge=[{title:t({id:"ProjectsList.Project"}),field:"name",filtering:!0,defaultSort:"asc",render:function(e){return l.createElement("div",{key:e._id,className:oe.iconContainer,"data-value":e.name},l.createElement(E,{title:t({id:"ProjectsList.Bookmark"})},l.createElement("div",{className:oe.iconBookmark,onClick:ke(e._id)},se.includes(e._id)?l.createElement(b,{fontSize:"inherit"}):l.createElement(g,{fontSize:"inherit"}))),l.createElement(T,{projectId:e._id}))}},{title:t({id:"ProjectsList.Customer"}),field:"customerId",filtering:!0,render:function(e){return l.createElement(R,{customerId:e.customerId})},customFilterAndSearch:function(e,t){var n;return ae.find((function(e){return e._id===t.customerId})).name.toLowerCase().includes(e.toLowerCase())||0===e.length}},{title:t({id:"ProjectsList.Status"}),field:"projectStatusId",lookup:ue.reduce((function(e,t){return e[t._id]=t.name,e}),{})},{title:t({id:"ProjectsList.Type"}),field:"billing",render:function(e){return"regie"===e.billing?t({id:"ProjectSettings.Regie"}):t({id:"ProjectSettings.Forfait"})}},{title:t({id:"ProjectsList.TJM"}),field:"amountHourly",render:function(e){return"regie"===e.billing?M(7*e.amountHourly):"-"}},{title:t({id:"ProjectsList.Invoices"}),field:"invoicesId",lookup:me.reduce((function(e,t){return e[t._id]=t.name,e}),{}),render:function(e){return!!e.invoicesId&&e.invoicesId.filter((function(e){return null!==e})).map((function(e,t){var n,i=null===(n=me.find((function(t){return t._id===e})))||void 0===n?void 0:n.name;return t>0?l.createElement(a,{key:t},l.createElement("br",null),i):i}))}},{title:t({id:"ProjectsList.Collaborators",defaultMessage:"Collaborateurs"}),field:"usersId",sorting:!1,filtering:!1,render:function(e){var t;return l.createElement("div",null,null===(t=e.usersId)||void 0===t?void 0:t.map((function(e,t){return l.createElement("div",{key:e,style:{marginTop:t>0?4:0}},l.createElement(J,{userId:e,disableAvailability:!0,disableCalculationAvailable:!0}))})))}},{title:t({id:"ProjectsList.StartDate",defaultMessage:"Date de début"}),field:"startDate",type:"date",sorting:!1},{title:t({id:"ProjectsList.EndDate",defaultMessage:"Date de fin"}),field:"endDate",type:"date",sorting:!1},{title:t({id:"ProjectsList.Active"}),field:"active",type:"boolean",defaultFilter:"checked",sorting:!1},{title:"Actions",field:"actions",sorting:!1,filtering:!1,align:"right"}],be=le.map((function(e){var t=D(F,{_id:e.projectStatusId});return r(r({},e),{},{projectStatus:t?t.name:""})})),ve=function(e){W(!1),e&&de.push("/teams/projects/"+e+"/resume")},je=function(e){return function(){function n(n){return i.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return n.preventDefault(),n.stopPropagation(),r.next=4,i.awrap(pe({confirmationText:t({id:"Actions.Duplicate",defaultMessage:"Dupliquer"})}));case 4:p.promise("projects.duplicate",{projectId:e}).then((function(){return m.success(t({id:"success"}))})).catch((function(){return m.error(t({id:"error"}))}));case 5:case"end":return r.stop()}}return r}(),null,null,null,Promise)}return n}()},Ee=function(e){return l.createElement("div",null,l.createElement(I,null,l.createElement(y,null)),x(B.USER)&&l.createElement(E,{title:t({id:"ProjectsList.Duplicate",defaultMessage:"Dupliquer le projet"})},l.createElement(I,{onClick:je(e._id)},l.createElement(v,null))))},he=U(ge,ie),ye=(be||[]).map((function(e){return r(r({},e),{},{actions:Ee(e)})})),Ie=function(){var e=he.filter((function(e){return"actions"!==e.field}));return Q(e,ye.map((function(t){return e.map((function(e){var n=t[e.field];return"customerId"===e.field?H.findOne(n).name:"projectStatusId"===e.field?F.findOne(n).name:"usersId"===e.field?n.map((function(e){return G(e)})).join(", "):"estimatedTime"===e.field?L(n):"startDate"===e.field||"endDate"===e.field?n?Y(n,K.DATEONLY):"":n}))})),"projects")};return l.createElement("div",{id:"projects-table"},x(B.USER)&&P&&l.createElement(O,{onClose:ve}),l.createElement(S,{loading:!be,data:ye,columns:he,onRowClick:function(e,t){return de.push("/teams/projects/"+t._id+"/resume")},components:{Actions:function(){return l.createElement(l.Fragment,null,l.createElement(N,{style:{marginRight:16},columns:U(ge,ie),onColumnsChanged:re}),l.createElement(w,{id:"button-filter-project",onClick:function(){return ee(!$)},size:"small",color:$?"secondary":"default",variant:"outlined",style:{marginRight:16}},l.createElement(h,{fontSize:"small"}),"  ",l.createElement(s,{id:"Actions.Filtrer"})),l.createElement(w,{id:"button-export-project",onClick:function(){return Ie()},size:"small",color:"default",variant:"outlined",style:{marginRight:16},blockedFeature:!q("standard"),placement:"left"},l.createElement(C,{fontSize:"small"}),"  ",l.createElement(s,{id:"Actions.Export"})),l.createElement(w,{id:"button-add-project",onClick:function(){return W(!0)},size:"large",blockedFeature:!q("standard")&&be.length>=10,restrictedFeature:B.MANAGE_PROJECT,placement:"left"},l.createElement(s,{id:"Project.Add"})))}},options:{search:!1,columnsButton:!1,showTitle:!1,filtering:$,padding:"dense"}}))};n.exportDefault(W)}

